<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anki写卡助手 - 智能生成记忆卡片</title>
    <meta name="description" content="使用AI技术智能生成Anki记忆卡片，支持多种格式导出，提升学习效率">
    
    <!-- 预加载关键资源 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 样式表 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    
    <!-- PWA支持 -->
    <meta name="theme-color" content="#4a90e2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Anki写卡助手">
</head>
<body>
    <div class="container-fluid">
        <!-- 现代化导航栏 -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand d-flex align-items-center" href="#">
                    <i class="fas fa-brain me-2"></i>
                    <span>Anki写卡助手</span>
                </a>
                
                <div class="d-flex align-items-center gap-3">
                    <!-- 连接状态 -->
                    <div id="connection-status" class="d-flex align-items-center">
                        <i class="fas fa-circle text-warning me-2"></i>
                        <span>连接中...</span>
                    </div>
                    
                    <!-- 历史记录按钮 -->
                    <button class="btn btn-outline-light btn-sm" id="history-btn" title="历史记录">
                        <i class="fas fa-history"></i>
                    </button>
                    
                    <!-- 设置按钮 -->
                    <button class="btn btn-outline-light btn-sm" id="settings-btn" title="设置">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- 主要内容区域 -->
            <div class="row">
                <!-- 左侧控制面板 -->
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-cogs me-2"></i>生成设置
                            </h5>
                        </div>
                        <div class="card-body">
                            <form id="generation-form">
                                <!-- 内容输入方式选择 -->
                                <div class="mb-3">
                                    <div class="btn-group w-100" role="group" aria-label="内容输入方式">
                                        <input type="radio" class="btn-check" name="input-method" id="text-input" value="text" checked>
                                        <label class="btn btn-outline-primary" for="text-input">
                                            <i class="fas fa-edit me-2"></i>文本输入
                                        </label>
                                        
                                        <input type="radio" class="btn-check" name="input-method" id="file-input" value="file">
                                        <label class="btn btn-outline-primary" for="file-input">
                                            <i class="fas fa-file-upload me-2"></i>文件上传
                                        </label>
                                    </div>
                                </div>

                                <!-- 文本输入区域 -->
                                <div id="text-input-area" class="mb-4">
                                    <label for="content-input" class="form-label">
                                        <i class="fas fa-edit me-2"></i>输入内容
                                    </label>
                                    <textarea class="form-control" id="content-input" rows="8" 
                                              placeholder="请输入要生成卡片的内容...&#10;支持纯文本、Markdown格式&#10;&#10;示例：&#10;- 学习要点1&#10;- 学习要点2&#10;- 重要概念解释"></textarea>
                                    <div class="form-text">
                                        <small class="text-muted">支持纯文本和Markdown格式，内容越详细，生成的卡片质量越高</small>
                                    </div>
                                </div>

                                <!-- 文件上传区域 -->
                                <div id="file-input-area" class="mb-4" style="display: none;">
                                    <label class="form-label">
                                        <i class="fas fa-file-upload me-2"></i>上传文件
                                    </label>
                                    
                                    <!-- 文件拖拽区域 -->
                                    <div class="file-drop-zone" id="file-drop-zone">
                                        <div class="file-drop-content">
                                            <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-3"></i>
                                            <h5>拖拽文件到此处或点击选择</h5>
                                            <p class="text-muted">支持 .txt, .md, .docx, .pdf, .csv, .xlsx, .xls 格式</p>
                                            <input type="file" id="file-upload-input" accept=".txt,.md,.docx,.pdf,.csv,.xlsx,.xls" style="display: none;">
                                        </div>
                                    </div>

                                    <!-- 文件信息显示 -->
                                    <div id="file-info" class="mt-3" style="display: none;">
                                        <div class="card">
                                            <div class="card-body">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <h6 class="card-title mb-1" id="file-name"></h6>
                                                        <p class="card-text text-muted mb-2" id="file-details"></p>
                                                        <div id="file-warnings" class="text-warning"></div>
                                                    </div>
                                                    <button type="button" class="btn btn-sm btn-outline-danger" id="remove-file">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>
                                                

                                            </div>
                                        </div>
                                    </div>
                                </div>



                                <!-- 牌组名称设置 -->
                                <div class="mb-3">
                                    <label for="deck-name-input" class="form-label">
                                        <i class="fas fa-folder me-2"></i>牌组名称
                                    </label>
                                    <input type="text" class="form-control" id="deck-name-input" 
                                           placeholder="留空使用AI生成的牌组名称">
                                    <div class="form-text">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            自定义牌组名称，优先级高于AI生成。留空时AI将根据内容自动生成合适的牌组名称
                                        </small>
                                    </div>
                                </div>

                                <!-- 高级设置区域 -->
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="template-select" class="form-label">
                                            <i class="fas fa-layer-group me-2"></i>卡片模板
                                        </label>
                                        <select class="form-select" id="template-select">
                                            <option value="">加载中...</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="prompt-select" class="form-label">
                                            <i class="fas fa-comment-dots me-2"></i>提示词类型
                                        </label>
                                        <select class="form-select" id="prompt-select">
                                            <option value="">加载中...</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="difficulty-select" class="form-label">
                                            <i class="fas fa-signal me-2"></i>难度
                                        </label>
                                        <select class="form-select" id="difficulty-select">
                                            <option value="easy">简单</option>
                                            <option value="medium" selected>中等</option>
                                            <option value="hard">困难</option>
                                        </select>
                                    </div>

                                    <div class="col-md-6 mb-3">
                                        <label for="card-count" class="form-label">
                                            <i class="fas fa-hashtag me-2"></i>卡片数量
                                        </label>
                                        <input type="number" class="form-control" id="card-count" 
                                               value="5" min="1" max="20" title="建议生成5-10张卡片">
                                    </div>
                                </div>

                                <!-- 导出格式 -->
                                <div class="mb-4">
                                    <label class="form-label">
                                        <i class="fas fa-download me-2"></i>导出格式
                                    </label>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input export-format-checkbox" type="checkbox" value="json" id="export-json">
                                                <label class="form-check-label" for="export-json">
                                                    <i class="fas fa-code me-2"></i>JSON
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input export-format-checkbox" type="checkbox" value="html" id="export-html">
                                                <label class="form-check-label" for="export-html">
                                                    <i class="fas fa-code me-2"></i>HTML
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input export-format-checkbox" type="checkbox" value="apkg" id="export-apkg">
                                                <label class="form-check-label" for="export-apkg">
                                                    <i class="fas fa-file-export me-2"></i>APKG
                                                </label>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="form-check">
                                                <input class="form-check-input export-format-checkbox" type="checkbox" value="csv" id="export-csv">
                                                <label class="form-check-label" for="export-csv">
                                                    <i class="fas fa-table me-2"></i>CSV
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input export-format-checkbox" type="checkbox" value="txt" id="export-txt">
                                                <label class="form-check-label" for="export-txt">
                                                    <i class="fas fa-file-alt me-2"></i>TXT
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-text">
                                        <small class="text-muted">
                                            <i class="fas fa-info-circle me-1"></i>
                                            修改导出格式将自动保存到配置文件
                                        </small>
                                    </div>
                                </div>

                                <!-- 生成按钮 -->
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg" id="generate-btn">
                                        <span class="btn-content">
                                            <i class="fas fa-magic me-2"></i>
                                            <span>开始生成卡片</span>
                                        </span>
                                        <span class="btn-loading d-none">
                                            <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                            <span>正在生成...</span>
                                        </span>
                                    </button>
                                </div>
                                
                                <!-- 进度条 -->
                                <div class="mt-3 d-none" id="generation-progress">
                                    <div class="progress">
                                        <div class="progress-bar" role="progressbar" style="width: 0%" id="progress-bar"></div>
                                    </div>
                                    <div class="d-flex justify-content-between mt-2">
                                        <small class="text-muted" id="progress-text">准备中...</small>
                                        <small class="text-muted" id="progress-percent">0%</small>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- 右侧结果区域 -->
                <div class="col-lg-8">
                    <!-- 文件内容预览 -->
                    <div class="card mb-3 d-none" id="file-preview-card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-eye me-2"></i>文件内容预览
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="content-preview" id="content-preview"></div>
                        </div>
                    </div>

                    <!-- 章节选择 -->
                    <div class="card mb-3 d-none" id="sections-selection-card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-list me-2"></i>选择要处理的章节
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="select-all-sections">
                                <label class="form-check-label" for="select-all-sections">
                                    全选所有章节
                                </label>
                            </div>
                            <div id="sections-list" class="sections-list"></div>
                        </div>
                    </div>

                    <!-- 提示词编辑器 -->
                    <div class="card mb-3 d-none" id="prompt-editor-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-edit me-2"></i>提示词编辑器
                            </h5>
                            <div class="d-flex align-items-center gap-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" id="save-prompt-btn" title="保存提示词">
                                    <i class="fas fa-save me-2"></i>保存
                                </button>
                                <button type="button" class="btn btn-outline-secondary btn-sm" id="reset-prompt-btn" title="重置提示词">
                                    <i class="fas fa-undo me-2"></i>重置
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="prompt-editor" class="form-label">
                                    <i class="fas fa-comment-dots me-2"></i>提示词内容
                                </label>
                                <textarea class="form-control" id="prompt-editor" rows="12" 
                                          placeholder="选择提示词类型后，这里将显示提示词内容，您可以进行编辑..."></textarea>
                                <div class="form-text">
                                    <small class="text-muted">
                                        <i class="fas fa-info-circle me-1"></i>
                                        提示词中的 {变量名} 格式的变量会在生成时自动替换
                                    </small>
                                </div>
                            </div>
                            <div class="alert alert-info d-none" id="prompt-info">
                                <i class="fas fa-info-circle me-2"></i>
                                <span id="prompt-info-text">提示词信息</span>
                            </div>
                        </div>
                    </div>

                    <!-- 状态指示器 -->
                    <div class="alert alert-info d-none" id="status-alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <span id="status-message">准备就绪</span>
                    </div>

                    <!-- 结果摘要 -->
                    <div class="card mb-3 d-none" id="summary-card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-chart-pie me-2"></i>生成摘要
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row" id="summary-content">
                                <!-- 摘要内容将在这里显示 -->
                            </div>
                        </div>
                    </div>

                    <!-- 卡片预览 -->
                    <div class="card mb-3 d-none" id="cards-card">
                        <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-eye me-2"></i>卡片预览
                            </h5>
                            <div class="d-flex align-items-center gap-2">
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm" id="prev-card" title="上一张">
                                        <i class="fas fa-chevron-left"></i>
                                    </button>
                                    <span class="btn btn-outline-secondary btn-sm" id="card-counter">1 / 1</span>
                                    <button type="button" class="btn btn-outline-primary btn-sm" id="next-card" title="下一张">
                                        <i class="fas fa-chevron-right"></i>
                                    </button>
                                </div>
                                <button type="button" class="btn btn-outline-success btn-sm" id="export-apkg-btn" title="导出为Anki包">
                                    <i class="fas fa-file-export me-2"></i>导出APKG
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="card-preview">
                                <div class="text-center text-muted py-4">
                                    <i class="fas fa-cards-blank fa-3x mb-3"></i>
                                    <p>卡片预览将在这里显示</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 导出结果 -->
                    <div class="card d-none" id="export-card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-download me-2"></i>导出结果
                            </h5>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="download-all-btn">
                                <i class="fas fa-download me-2"></i>下载全部
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row" id="export-links">
                                <!-- 导出链接将在这里显示 -->
                            </div>
                            <div class="mt-3 pt-3 border-top">
                                <p class="text-muted mb-2">
                                    <i class="fas fa-info-circle me-2"></i>
                                    提示：建议下载JSON格式用于导入Anki，或下载APKG格式直接在Anki中使用
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 浮动操作按钮 -->
    <button class="fab d-none" id="scroll-to-top" title="回到顶部">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- 现代化加载提示模态框 -->
    <div class="modal fade" id="loading-modal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-magic me-2"></i>AI正在生成卡片
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <div class="loading-pulse">
                            <div class="spinner-border text-primary mb-3" role="status" style="width: 3rem; height: 3rem;">
                                <span class="visually-hidden">生成中...</span>
                            </div>
                        </div>
                        <h6 class="mb-3">正在生成卡片...</h6>
                        <p class="text-muted mb-3" id="loading-message">AI正在分析您的内容，请稍候...</p>
                        
                        <!-- 进度提示 -->
                        <div class="progress mb-3" style="height: 6px;">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 role="progressbar" style="width: 100%"></div>
                        </div>
                        
                        <div class="row text-center">
                            <div class="col-4">
                                <i class="fas fa-search text-muted mb-1"></i>
                                <br><small class="text-muted">内容分析</small>
                            </div>
                            <div class="col-4">
                                <i class="fas fa-brain text-muted mb-1"></i>
                                <br><small class="text-muted">AI生成</small>
                            </div>
                            <div class="col-4">
                                <i class="fas fa-check text-muted mb-1"></i>
                                <br><small class="text-muted">格式化</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- APKG导出模态框 -->
    <div class="modal fade" id="apkg-export-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-file-export me-2"></i>导出Anki包
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="apkg-export-form">
                        <div class="mb-3">
                            <label for="deck-name" class="form-label">牌组名称</label>
                            <input type="text" class="form-control" id="deck-name" 
                                   value="AI生成卡片" placeholder="输入牌组名称">
                        </div>
                        <div class="mb-3">
                            <label for="filename" class="form-label">文件名</label>
                            <input type="text" class="form-control" id="filename" 
                                   placeholder="留空使用默认名称">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-primary" id="confirm-apkg-export">
                        <i class="fas fa-download me-2"></i>导出
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模态框 -->
    <div class="modal fade" id="settings-modal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-cog me-2"></i>应用设置
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="settings-form">
                        <!-- AI设置 -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-robot me-2"></i>AI设置
                                </h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="api-key" class="form-label">API密钥</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="api-key" 
                                                   placeholder="输入您的API密钥">
                                            <button class="btn btn-outline-secondary" type="button" id="toggle-api-key">
                                                <i class="fas fa-eye" id="toggle-api-key-icon"></i>
                                            </button>
                                        </div>
                                        <div class="form-text">您的API密钥将安全存储</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="base-url" class="form-label">API基础URL</label>
                                        <input type="url" class="form-control" id="base-url" 
                                               placeholder="https://api.openai.com/v1">
                                        <div class="form-text">OpenAI兼容的API端点</div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="model-name" class="form-label">模型名称</label>
                                        <input type="text" class="form-control" id="model-name" 
                                               placeholder="gpt-3.5-turbo">
                                        <div class="form-text">要使用的模型名称</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="temperature" class="form-label">温度 (0-2)</label>
                                        <input type="number" class="form-control" id="temperature" 
                                               min="0" max="2" step="0.1" value="0.7">
                                        <div class="form-text">控制输出的随机性</div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="max-tokens" class="form-label">最大令牌数</label>
                                        <input type="number" class="form-control" id="max-tokens" 
                                               min="100" max="256000" value="20000">
                                        <div class="form-text">单次请求的最大令牌数</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="timeout" class="form-label">超时时间 (秒)</label>
                                        <input type="number" class="form-control" id="timeout" 
                                               min="10" max="120" value="30">
                                        <div class="form-text">API请求超时时间</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-outline-primary" id="test-api-btn">
                        <i class="fas fa-vial me-2"></i>API测试
                    </button>
                    <button type="button" class="btn btn-primary" id="save-settings-btn">
                        <i class="fas fa-save me-2"></i>保存设置
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 历史记录模态框 -->
    <div class="modal fade" id="history-modal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-history me-2"></i>历史生成记录</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- 加载状态 -->
                    <div id="history-loading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2 text-muted">正在加载历史记录...</p>
                    </div>
                    
                    <!-- 历史记录列表 -->
                    <div id="history-list" class="d-none">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h6 class="mb-0">生成记录 (<span id="history-count">0</span>)</h6>
                            <button class="btn btn-outline-primary btn-sm" id="refresh-history-btn">
                                <i class="fas fa-sync-alt me-1"></i>刷新
                            </button>
                        </div>
                        <div id="history-records" class="list-group">
                            <!-- 历史记录项将在这里动态生成 -->
                        </div>
                    </div>
                    
                    <!-- 空状态 -->
                    <div id="history-empty" class="text-center py-4 d-none">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <h6 class="text-muted">暂无历史记录</h6>
                        <p class="text-muted small">您还没有生成过任何卡片</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 历史记录详情模态框 -->
    <div class="modal fade" id="history-detail-modal" tabindex="-1">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-info-circle me-2"></i>记录详情</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- 加载状态 -->
                    <div id="detail-loading" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">加载中...</span>
                        </div>
                        <p class="mt-2 text-muted">正在加载详情...</p>
                    </div>
                    
                    <!-- 详情内容 -->
                    <div id="detail-content" class="d-none">
                        <!-- 基本信息 -->
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-info me-2"></i>基本信息</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>生成时间：</strong><span id="detail-timestamp"></span></p>
                                        <p><strong>牌组名称：</strong><span id="detail-deck-name"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>卡片数量：</strong><span id="detail-card-count"></span></p>
                                        <p><strong>原始内容：</strong><span id="detail-content-preview"></span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 卡片显示 -->
                        <div class="card mb-3">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0"><i class="fas fa-list me-2"></i>卡片详情</h6>
                                <div class="d-flex align-items-center gap-2">
                                    <span id="card-navigation-info" class="small text-muted">0 / 0</span>
                                    <div class="btn-group btn-group-sm" role="group">
                                        <button type="button" class="btn btn-outline-secondary" id="prev-card-btn" disabled>
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button type="button" class="btn btn-outline-secondary" id="next-card-btn" disabled>
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body">
                                <div id="detail-cards-list">
                                    <!-- 当前卡片将在这里显示 -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- 文件下载 -->
                        <div class="card">
                            <div class="card-header">
                                <h6 class="mb-0"><i class="fas fa-download me-2"></i>文件下载</h6>
                            </div>
                            <div class="card-body">
                                <div id="detail-files" class="row">
                                    <!-- 文件下载按钮将在这里动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-danger" id="delete-record-btn">
                        <i class="fas fa-trash me-2"></i>删除记录
                    </button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- API测试结果模态框 -->
    <div class="modal fade" id="api-test-modal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-robot me-2"></i>API测试结果</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="api-test-status" class="d-flex align-items-center mb-2 d-none">
                        <i id="api-test-status-dot" class="fas fa-circle me-2 text-muted"></i>
                        <span id="api-test-status-text" class="small text-muted">状态</span>
                    </div>
                    <div id="api-test-result" class="whitespace-pre-wrap"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 错误提示吐司 -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100">
        <div id="error-toast" class="toast hide" role="alert">
            <div class="toast-header">
                <i class="fas fa-exclamation-triangle text-danger me-2"></i>
                <strong class="me-auto">错误</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="error-toast-body">
                <!-- 错误消息 -->
            </div>
        </div>
    </div>

    <!-- 成功提示吐司 -->
    <div class="position-fixed top-0 end-0 p-3" style="z-index: 1100; margin-top: 80px;">
        <div id="success-toast" class="toast hide" role="alert">
            <div class="toast-header">
                <i class="fas fa-check-circle text-success me-2"></i>
                <strong class="me-auto">成功</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="success-toast-body">
                <!-- 成功消息 -->
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // 页面加载动画和滚动位置管理
        document.addEventListener('DOMContentLoaded', function() {
            // 添加loading类防止闪烁
            document.body.classList.add('loading');
            document.body.classList.add('fade-in');
            
            // 页面完全加载后移除loading类
            window.addEventListener('load', function() {
                document.body.classList.remove('loading');
                document.body.classList.add('loaded');
            });
        });
        
        // 平滑滚动
        document.addEventListener('click', function(e) {
            if (e.target.matches('a[href^="#"]')) {
                e.preventDefault();
                const target = document.querySelector(e.target.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            }
        });
        
        // 回到顶部按钮
        window.addEventListener('scroll', function() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const scrollToTopBtn = document.getElementById('scroll-to-top');
            if (scrollTop > 300) {
                scrollToTopBtn.classList.remove('d-none');
            } else {
                scrollToTopBtn.classList.add('d-none');
            }
        });
        
        document.getElementById('scroll-to-top').addEventListener('click', function() {
            if (window.app && typeof window.app.scrollToTop === 'function') {
                window.app.scrollToTop();
            } else {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        });
    </script>
    <script src="/static/js/app.js"></script>
</body>
</html>
