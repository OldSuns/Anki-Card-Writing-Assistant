# 文件导入功能说明

## 功能概述

Anki写卡助手现已支持文件导入功能，用户可以直接上传各种格式的文件来生成Anki卡片，无需手动复制粘贴内容。

## 支持的文件格式

### 文本文件
- `.txt` - 纯文本文件
- `.md` - Markdown文件

### 文档文件
- `.docx` - Microsoft Word文档
- `.pdf` - PDF文档

### 数据文件
- `.csv` - CSV表格文件
- `.xlsx` - Excel 2010+ 工作簿
- `.xls` - Excel 97-2003 工作簿

## 功能特点

### 1. 拖拽上传
- 支持文件拖拽到指定区域进行上传
- 实时显示上传状态和进度

### 2. 文件预览
- 显示文件基本信息（大小、行数、字数等）
- 提供内容预览功能
- 显示文件处理警告信息

### 3. 智能分割
- 自动按章节分割文档内容
- 支持用户选择特定章节进行处理
- 提供全选/取消全选功能

### 4. 批量处理
- 支持处理大型文档
- 自动合并选中的章节内容
- 保持文档结构完整性

## 使用方法

### 1. 选择输入方式
在生成设置面板中，选择"文件上传"模式。

### 2. 上传文件
- 点击"选择文件"按钮选择文件
- 或直接拖拽文件到上传区域

### 3. 预览和选择
- 查看文件信息和内容预览
- 选择要处理的章节（如果有多个章节）
- 检查警告信息

### 4. 生成卡片
- 设置生成参数（模板、提示词、数量等）
- 点击"生成卡片"按钮
- 等待处理完成

## 技术实现

### 后端处理
- `FileProcessor` 类负责文件解析和处理
- 支持多种编码格式（UTF-8、GBK、GB2312等）
- 自动检测和处理文件格式

### 前端界面
- 响应式设计，支持各种屏幕尺寸
- 实时状态反馈和错误处理
- 直观的文件信息显示

### 安全特性
- 文件类型验证
- 文件大小限制（50MB）
- 临时文件自动清理
- 编码自动检测

## 依赖包

新增的依赖包：
```
python-docx>=0.8.11    # Word文档处理
PyPDF2>=3.0.0         # PDF文档处理
openpyxl>=3.1.0       # Excel文件处理
```

## 注意事项

1. **文件大小限制**：单个文件最大50MB
2. **编码支持**：优先使用UTF-8，自动检测其他编码
3. **临时文件**：上传的文件会保存在临时目录中
4. **处理时间**：大文件可能需要较长的处理时间
5. **格式兼容性**：某些复杂格式可能无法完全保留

## 故障排除

### 常见问题

1. **文件上传失败**
   - 检查文件格式是否支持
   - 确认文件大小不超过限制
   - 检查网络连接

2. **内容显示异常**
   - 可能是编码问题，系统会自动尝试检测
   - 检查原始文件是否损坏

3. **处理速度慢**
   - 大文件需要更多处理时间
   - 可以尝试选择部分章节进行处理

### 错误信息

- `不支持的文件类型`：文件格式不在支持列表中
- `文件验证失败`：文件可能损坏或格式不正确
- `文件大小超过限制`：文件超过50MB限制
- `无法读取文件内容`：编码问题或文件损坏

## 更新日志

### v1.1.0 (当前版本)
- ✅ 添加文件上传功能
- ✅ 支持多种文件格式
- ✅ 实现拖拽上传
- ✅ 添加文件预览功能
- ✅ 支持章节选择
- ✅ 优化用户界面

## 未来计划

- [ ] 支持更多文件格式（如PPT、RTF等）
- [ ] 添加批量文件上传功能
- [ ] 实现文件处理进度显示
- [ ] 添加文件处理历史记录
- [ ] 支持自定义文件分割规则
